<div class="ml-48 pt-24 bg-darkBackground min-h-screen p-6">
  <!-- 喫煙カレンダー -->
  <div class="bg-cardBackground rounded-lg p-6 shadow-lg mb-6">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-2xl font-bold flex items-center text-white">
        <%= inline_svg_tag 'icons-calendar.svg', class: "w-6 h-6 mr-2" %>
        喫煙カレンダー
      </h2>
      <div class="flex space-x-2">
        <%= link_to '前月', smoker_smoking_records_path(start_date: @start_date.prev_month), class: 'btn btn-sm btn-outline' %>
        <span class="text-white text-xl"><%= @start_date.strftime('%Y年%m月') %></span>
        <%= link_to '次月', smoker_smoking_records_path(start_date: @start_date.next_month), class: 'btn btn-sm btn-outline' %>
      </div>
    </div>
    <div class="grid grid-cols-7 gap-2">
      <% ['日', '月', '火', '水', '木', '金', '土'].each do |day| %>
        <div class="text-center font-bold text-gray-500 text-sm"><%= day %></div>
      <% end %>
      
      <% (@start_date.beginning_of_month..@end_date).each do |date| %>
        <% if date == @start_date.beginning_of_month %>
          <% date.wday.times do %>
            <div></div>
          <% end %>
        <% end %>
        
        <div class="p-2 bg-itemBackground rounded-lg text-white hover:bg-opacity-80 transition-colors h-16 flex flex-col justify-between overflow-hidden">
          <div class="text-sm font-bold"><%= date.day %></div>
          <% if @calendar_data[date] %>
            <div class="text-xs text-customGreen"><%= @calendar_data[date][:count] %>本</div>
            <div class="text-xs text-yellow-500"><%= number_to_currency(@calendar_data[date][:amount], unit: '¥', precision: 0) %></div>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>

  <!-- 喫煙記録フォーム -->
  <div class="bg-cardBackground rounded-lg p-6 mb-6 shadow-lg">
    <%= form_with model: [:smoker, @new_smoking_record], url: smoker_smoking_records_path, local: true, class: "flex flex-col space-y-4" do |f| %>
      <% if @new_smoking_record.errors.any? %>
        <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4" role="alert">
          <strong class="font-bold">エラー:</strong>
          <ul class="mt-2 list-disc list-inside">
            <% @new_smoking_record.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

      <div class="flex flex-col md:flex-row items-center justify-between gap-4">
        <%= f.collection_select :cigarette_id, @cigarettes, :id, :brand, 
            { prompt: "タバコを選択" }, 
            class: "w-full md:w-2/3 p-3 bg-itemBackground text-white rounded-lg transition duration-300 hover:bg-gray-700 focus:ring-2 focus:ring-customGreen #{'border-red-500' if @new_smoking_record.errors[:cigarette_id].any?}" %>
        
        <%= button_tag type: 'submit', class: "w-full md:w-1/3 bg-customGreen hover:bg-customGreenHover text-white py-3 px-6 rounded-lg flex items-center justify-center transition duration-300" do %>
          <%= inline_svg_tag 'icons-smoking.svg', class: 'w-6 h-6 mr-2' %>
          喫煙を記録
        <% end %>
      </div>
    <% end %>
  </div>

<!-- 統計情報 -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
    <% [
      { icon: 'icons-coin.svg', title: "総合計金額", value: number_to_currency(@total_amount) },
      { icon: 'icons-coin.svg', title: "今日の合計金額", value: number_to_currency(@today_amount) },
      { icon: 'icons-cigarettes-pack.svg', title: "総本数", value: "#{@total_count}" },
      { icon: 'icons-cigarettes-pack.svg', title: "今日の本数", value: "#{@today_count}" }
    ].each do |item| %>
      <div class="bg-cardBackground p-4 rounded-lg shadow-lg transition duration-300 hover:shadow-xl flex items-center h-24">
        <div class="flex items-center justify-between w-full">
          <div class="flex items-center">
            <%= inline_svg_tag item[:icon], class: "w-6 h-6 mr-2"%>
            <span class="text-labelColor"><%= item[:title] %></span>
          </div>
          <div class="text-2xl font-bold text-white flex items-center">
            <%= item[:value] %>
            <% if item[:title].include?("本数") %>
              <span class="text-labelColor text-sm ml-1">本</span>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
  </div>

<!-- 喫煙記録ログ -->
  <div class="bg-cardBackground rounded-lg p-6 shadow-lg">
  <h2 class="text-2xl font-bold mb-4 flex items-center text-base-content">
    <i class="fas fa-clipboard-list mr-2"></i>
    今日の喫煙記録ログ
  </h2>
  <div class="max-h-[calc(100vh-400px)] overflow-y-auto">
    <ul class="space-y-3">
      <% @smoking_records.each do |log| %>
        <li class="bg-itemBackground p-3 rounded-lg shadow transition duration-300 hover:bg-base-100">
          <div class="flex justify-between items-center">
            <span class="text-base-content opacity-70"><%= log.smoked_at.strftime("%Y/%m/%d %H:%M") %></span>
            <span class="font-medium text-base-content"><%= log.cigarette.brand %></span>
            <span class="text-accent"><%= number_to_currency(log.price_per_cigarette) %></span>
            <%= button_to smoker_smoking_record_path(log), method: :delete, data: { turbo_confirm: "本当にこの記録を削除しますか？" }, class: "btn btn-ghost btn-xs" do %>
              <i class="fas fa-trash-alt text-error"></i>
            <% end %>
          </div>
        </li>
      <% end %>
    </ul>
  </div>
  <div class="mt-4">
    <%= paginate @smoking_records, window: 2 %>
  </div>
</div>
</div>